<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Ø­Ø§Ø³Ø¨Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© (Ù‚Ø¯ÙŠÙ… â†” Ø¬Ø¯ÙŠØ¯)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
    body { margin: 0; background: #f6f7fb; color: #111; -webkit-text-size-adjust: 100%; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 10px; }
    .card { background: #fff; border-radius: 18px; padding: 14px; box-shadow: 0 6px 20px rgba(0,0,0,.06); }
    .top { display: flex; gap: 10px; align-items: baseline; flex-wrap: wrap; }
    h1 { margin: 0; font-size: 20px; }
    .sub { margin: 10px 0 0; opacity: .86; font-size: 13px; line-height: 1.75; }
    .pill { display: inline-block; padding: 6px 10px; border-radius: 999px; background: #f1f2f7; font-size: 12px; opacity: .95; }

    .tabs { display: flex; gap: 8px; flex-wrap: wrap; margin: 14px 0 0; }
    .tab {
      border: 0; border-radius: 999px; padding: 12px 14px; font-size: 15px; cursor: pointer;
      background: #eef0ff; color: #111; min-height: 44px;
    }
    .tab.active { background: #111; color: #fff; }

    .box { border: 1px solid #e3e6f2; border-radius: 16px; padding: 12px; background: #fff; margin-top: 12px; }
    .boxTitle { font-size: 13px; opacity: .85; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; gap: 8px; }
    .mini { font-size: 12px; opacity: .74; line-height: 1.65; }

    label { display: block; font-size: 13px; margin-bottom: 6px; opacity: .9; }
    input {
      width: 100%; padding: 12px 12px; font-size: 22px;
      border: 1px solid #d9dbe7; border-radius: 12px; outline: none; background: #fff;
      min-height: 52px;
    }
    input:focus { border-color: #6b6eea; box-shadow: 0 0 0 3px rgba(107,110,234,.15); }

    button {
      border: 0; border-radius: 16px; padding: 12px 14px; font-size: 16px;
      cursor: pointer; background: #111; color: #fff; min-height: 48px;
    }
    button.secondary { background: #eef0ff; color: #111; }
    button.ghost { background: #f1f2f7; color: #111; }
    button.full { width: 100%; }
    button.small { font-size: 14px; min-height: 44px; border-radius: 14px; }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
    .btnRow3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
    .btnRow2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .row { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; align-items: center; }

    .outCard { margin-top: 12px; border-radius: 18px; padding: 14px; background: #0f172a; color: #fff; }
    .outLine { font-size: 16px; margin: 8px 0; display: flex; justify-content: space-between; gap: 12px; }
    .outLabel { opacity: .85; }
    .outValue { font-size: 22px; font-weight: 800; }
    .muted { opacity: .8; font-size: 13px; line-height: 1.75; margin-top: 10px; }
    .warn { font-size: 12px; color: #ffd2d2; opacity: .95; margin-top: 8px; }
    .ok { color: #b9ffcf; }
    .bad { color: #ffb4b4; }

    .stepPill { display:inline-block; padding:6px 10px; border-radius: 999px; background:#eef0ff; font-size:12px; opacity:.95; }
    .q { font-size: 18px; font-weight: 850; margin: 2px 0 8px; }
    .hidden { display: none !important; }

    .summaryCard { background:#fff; border:1px solid #e3e6f2; border-radius:16px; padding:12px; margin-top:12px; }
    .summaryLine { display:flex; justify-content:space-between; gap:12px; margin:8px 0; font-size:14px; }
    .summaryKey { opacity:.75; }
    .summaryVal { font-weight:750; }

    /* ===== Fun tab ===== */
    .funWrap { text-align:center; }
    .funTitle { font-size:18px; font-weight:850; margin: 4px 0 8px; }
    .funStage {
      margin-top: 12px;
      border-radius: 18px;
      padding: 16px;
      background: #0f172a;
      color: #fff;
      min-height: 240px;
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    .dancers {
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:center;
      flex-wrap: wrap;
      font-size: 52px;
      line-height: 1;
    }
    .dancers span { display:inline-block; }
    .shimmy1 { animation: shimmy 1.15s ease-in-out infinite; }
    .shimmy2 { animation: shimmy 1.35s ease-in-out infinite; }
    .shimmy3 { animation: shimmy 1.25s ease-in-out infinite; }
    .shimmy4 { animation: shimmy 1.45s ease-in-out infinite; }

    @keyframes shimmy {
      0%   { transform: translateY(0) rotate(-6deg) scale(1); }
      25%  { transform: translateY(-6px) rotate(6deg) scale(1.02); }
      50%  { transform: translateY(0) rotate(-6deg) scale(1); }
      75%  { transform: translateY(6px) rotate(6deg) scale(1.02); }
      100% { transform: translateY(0) rotate(-6deg) scale(1); }
    }

    @media (max-width: 820px) {
      .grid { grid-template-columns: 1fr; }
      .btnRow3 { grid-template-columns: 1fr; }
      .btnRow2 { grid-template-columns: 1fr; }
      .wrap { padding: 10px; }
      .dancers { font-size: 46px; }
      .funStage { min-height: 220px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="top">
        <h1>Ø­Ø§Ø³Ø¨Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø© (Ù‚Ø¯ÙŠÙ… â†” Ø¬Ø¯ÙŠØ¯)</h1>
        <span class="pill" id="rulePill">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„: Ù¡ Ø¬Ø¯ÙŠØ¯Ø© = Ù¡Ù Ù  Ù‚Ø¯ÙŠÙ…Ø©</span>
      </div>

      <p class="sub">
        ØªØ¨ÙˆÙŠØ¨ "Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ" ÙŠØ¹Ù…Ù„ ÙƒØ®Ø·ÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø©: <b>Ø§Ù„Ø³Ø¹Ø±</b> â†’ <b>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</b> â†’ <b>Ø§Ù„Ù†ØªÙŠØ¬Ø©</b> â†’ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) <b>Ø§Ù„ØªØ­Ù‚Ù‚</b>.
        <br><span class="mini">ØªØ¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ù¡Ù¢Ù£) ÙˆØ§Ù„ÙÙˆØ§ØµÙ„ Ù…Ø«Ù„ 50,000 Ø£Ùˆ 50 000.</span>
      </p>

      <div class="tabs" role="tablist" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹">
        <button class="tab active" id="tabConvert" type="button">ØªØ­ÙˆÙŠÙ„ Ø³Ø±ÙŠØ¹</button>
        <button class="tab" id="tabWizard" type="button">Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ (Ø®Ø·ÙˆØ§Øª)</button>
        <button class="tab" id="tabFun" type="button">ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ù‘Ùƒ ğŸ˜„</button>
      </div>

      <!-- ===== Tab 1: Convert quick ===== -->
      <section id="sectionConvert">
        <div class="box">
          <div class="boxTitle"><span>ØªØ­ÙˆÙŠÙ„ Ø³Ø±ÙŠØ¹</span><span class="mini">Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø£Ø®Ø±Ù‰</span></div>

          <div class="btnRow2">
            <button id="priceIsNewBtn" type="button">Ø§Ù„Ø³Ø¹Ø± Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="secondary" id="priceIsOldBtn" type="button">Ø§Ù„Ø³Ø¹Ø± Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
          </div>

          <div class="grid" style="margin-top:12px;">
            <div>
              <label for="oldAmt">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
              <input id="oldAmt" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 500000" />
            </div>
            <div>
              <label for="newAmt">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
              <input id="newAmt" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 500" />
            </div>
          </div>

          <div class="outCard" aria-live="polite">
            <div class="outLine"><span class="outLabel">Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span><span class="outValue" id="totalNew">0</span></div>
            <div class="outLine"><span class="outLabel">Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</span><span class="outValue" id="totalOld">0</span></div>
            <div class="warn" id="convertWarn"></div>
          </div>

          <div class="row">
            <button class="full" id="copyConvert" type="button">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <span class="mini" id="copyConvertStatus"></span>
          </div>
        </div>
      </section>

      <!-- ===== Tab 2: Wizard ===== -->
      <section id="sectionWizard" class="hidden">

        <!-- Step 1 -->
        <div class="box" id="step1">
          <div class="boxTitle"><span class="stepPill">Ø§Ù„Ø®Ø·ÙˆØ© 1</span><span class="mini">Ø§Ù„Ø³Ø¹Ø±</span></div>
          <div class="q">ÙƒÙ… Ø³Ø¹Ø±/Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§ØªØŸ</div>

          <div class="btnRow3">
            <button class="ghost" id="s1_old" type="button">Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙ‚Ø·</button>
            <button class="ghost" id="s1_new" type="button">Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</button>
            <button class="ghost" id="s1_both" type="button">Ø¨Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†</button>
          </div>

          <div class="grid" style="margin-top:12px;">
            <div id="s1_old_box" class="hidden">
              <label for="s1_old_in">Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
              <input id="s1_old_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 50000" />
            </div>
            <div id="s1_new_box" class="hidden">
              <label for="s1_new_in">Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
              <input id="s1_new_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 500" />
            </div>
          </div>

          <div class="row">
            <button id="s1_next" class="full" type="button">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <div class="warn" id="s1_warn"></div>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="box hidden" id="step2">
          <div class="boxTitle"><span class="stepPill">Ø§Ù„Ø®Ø·ÙˆØ© 2</span><span class="mini">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</span></div>

          <div class="outCard" aria-live="polite">
            <div class="muted" id="k_price_hint">â€”</div>
          </div>

          <div class="q" style="margin-top:12px;">ÙƒÙ… Ø³ÙŠØªÙ… Ø¯ÙØ¹Ù‡ Ø§Ù„Ø¢Ù†ØŸ</div>

          <div class="btnRow3">
            <button class="ghost" id="s2_old" type="button">Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙ‚Ø·</button>
            <button class="ghost" id="s2_new" type="button">Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</button>
            <button class="ghost" id="s2_both" type="button">Ø¨Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†</button>
          </div>

          <div class="grid" style="margin-top:12px;">
            <div id="s2_old_box" class="hidden">
              <label for="s2_old_in">Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
              <input id="s2_old_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 100000" />
            </div>
            <div id="s2_new_box" class="hidden">
              <label for="s2_new_in">Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
              <input id="s2_new_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 0" />
            </div>
          </div>

          <div class="row">
            <button id="s2_next" class="full" type="button">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <button id="s2_back" class="secondary full" type="button">Ø±Ø¬ÙˆØ¹</button>
            <div class="warn" id="s2_warn"></div>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="box hidden" id="step3">
          <div class="boxTitle"><span class="stepPill">Ø§Ù„Ø®Ø·ÙˆØ© 3</span><span class="mini">Ø§Ù„Ù†ØªÙŠØ¬Ø©</span></div>

          <div class="outCard" aria-live="polite" id="r_card">
            <div class="muted" id="r_message">â€”</div>
            <div class="warn" id="r_warn"></div>
          </div>

          <div class="box hidden" id="needMoreBox" style="margin-top:12px;">
            <div class="boxTitle"><span>Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ</span><span class="mini">Ø¥Ø°Ø§ Ø³ÙŠØªÙ… Ø¯ÙØ¹ Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„Ø¢Ù†</span></div>
            <div class="q">ÙƒÙ… Ø³ÙŠØªÙ… Ø¯ÙØ¹Ù‡ Ø¥Ø¶Ø§ÙÙŠØ§Ù‹ Ø§Ù„Ø¢Ù†ØŸ</div>

            <div class="btnRow3">
              <button class="ghost" id="s3_old" type="button">Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙ‚Ø·</button>
              <button class="ghost" id="s3_new" type="button">Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</button>
              <button class="ghost" id="s3_both" type="button">Ø¨Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†</button>
            </div>

            <div class="grid" style="margin-top:12px;">
              <div id="s3_old_box" class="hidden">
                <label for="s3_old_in">Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
                <input id="s3_old_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 10000" />
              </div>
              <div id="s3_new_box" class="hidden">
                <label for="s3_new_in">Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                <input id="s3_new_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 100" />
              </div>
            </div>

            <div class="row">
              <button id="s3_apply" class="full" type="button">Ø§Ø­Ø³Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</button>
              <div class="warn" id="s3_warn"></div>
            </div>
          </div>

          <div class="box hidden" id="verifyPromptBox" style="margin-top:12px;">
            <div class="boxTitle"><span>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠ</span><span class="mini">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span></div>
            <div class="q">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø£Ø¹Ø§Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ù…Ø¨Ù„ØºØ§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹ Ø£Ùˆ Ø£Ø¹Ø§Ø¯ Ø¨Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†ØŒ ÙˆØ³Ù†ØªØ­Ù‚Ù‚ Ù…Ø¹Ø§Ù‹.</div>

            <div class="btnRow2">
              <button id="verify_yes" type="button">Ù†Ø¹Ù…ØŒ ØªØ­Ù‚Ù‚</button>
              <button id="verify_no" class="secondary" type="button">Ù„Ø§</button>
            </div>

            <div id="verify_inputs_area" class="hidden" style="margin-top:12px;">
              <div class="mini">ÙƒÙ… ÙƒØ§Ù† Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…ØŸ</div>

              <div class="btnRow3">
                <button class="ghost" id="v_old" type="button">Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙ‚Ø·</button>
                <button class="ghost" id="v_new" type="button">Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</button>
                <button class="ghost" id="v_both" type="button">Ø¨Ø§Ù„Ø¹Ù…Ù„ØªÙŠÙ†</button>
              </div>

              <div class="grid" style="margin-top:12px;">
                <div id="v_old_box" class="hidden">
                  <label for="v_old_in">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</label>
                  <input id="v_old_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 50000" />
                </div>
                <div id="v_new_box" class="hidden">
                  <label for="v_new_in">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                  <input id="v_new_in" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 0" />
                </div>
              </div>

              <div class="row">
                <button id="v_check" class="full" type="button">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>
                <div class="warn" id="v_warn"></div>
              </div>

              <div class="outCard hidden" id="v_out">
                <div class="outLine"><span class="outLabel">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)</span><span class="outValue" id="v_expected_new">0</span></div>
                <div class="outLine"><span class="outLabel">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)</span><span class="outValue" id="v_expected_old">0</span></div>
                <div class="outLine"><span class="outLabel">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)</span><span class="outValue" id="v_received_new">0</span></div>
                <div class="outLine"><span class="outLabel">Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)</span><span class="outValue" id="v_received_old">0</span></div>
                <div class="muted" id="v_msg">â€”</div>
              </div>
            </div>
          </div>

          <div class="summaryCard hidden" id="finalSummary">
            <div class="boxTitle"><span class="stepPill">Ù…Ù„Ø®Øµ</span><span class="mini">ÙŠÙ…ÙƒÙ† Ø¥Ø¸Ù‡Ø§Ø± Ù‡Ø°Ø§ Ù„Ù„Ø¨Ø§Ø¦Ø¹</span></div>

            <div class="summaryLine"><span class="summaryKey">Ø§Ù„Ø³Ø¹Ø±</span><span class="summaryVal" id="sum_price">â€”</span></div>
            <div class="summaryLine"><span class="summaryKey">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</span><span class="summaryVal" id="sum_paid">â€”</span></div>
            <div class="summaryLine"><span class="summaryKey">Ø§Ù„Ù†ØªÙŠØ¬Ø©</span><span class="summaryVal" id="sum_result">â€”</span></div>

            <div class="row">
              <button class="full" id="copySummary" type="button">Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ø®Øµ</button>
              <span class="mini" id="copySummaryStatus"></span>
            </div>

            <div class="row">
              <button class="secondary full" id="restart" type="button">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
            </div>
          </div>

          <div class="row">
            <button class="full" id="copyResult" type="button">Ù†Ø³Ø® Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <span class="mini" id="copyResultStatus"></span>
          </div>

        </div>
      </section>

      <!-- ===== Tab 3: Fun ===== -->
      <section id="sectionFun" class="hidden">
        <div class="box funWrap">
          <div class="boxTitle">
            <span>ÙˆÙ„Ø§ ÙŠÙ‡Ù…Ù‘Ùƒ ğŸ˜„</span>
            <span class="mini">Ø¥Ø°Ø§ Ø¶Ø§ÙŠØ¹/Ø©â€¦ Ø®Ø°/ÙŠ Ù†ÙØ³ ÙˆØ´ÙˆÙ/ÙŠ Ø±Ù‚Øµ</span>
          </div>

          <div class="funTitle">Ù…Ùˆ Ø¹Ø§Ø±Ù/Ø© Ø´Ùˆ ØªØ¹Ù…Ù„ØŸ Ø·ÙŠØ¨â€¦ ÙˆØ±Ù‘ÙŠÙ†ÙŠ Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø¨ØªØ±Ù‚Øµ ğŸ’ƒğŸ•º</div>

          <div class="btnRow3">
            <button class="ghost" id="funCats" type="button">Ù‚Ø·Ø·</button>
            <button class="ghost" id="funDogs" type="button">ÙƒÙ„Ø§Ø¨</button>
            <button class="secondary" id="funBoth" type="button">Ø§Ù„ÙƒÙ„</button>
          </div>

          <div class="funStage" aria-live="polite">
            <div class="dancers" id="funStage">
              <!-- default: both -->
              <span class="shimmy1">ğŸ±</span>
              <span class="shimmy2">ğŸ’ƒ</span>
              <span class="shimmy3">ğŸ¶</span>
              <span class="shimmy4">ğŸ•º</span>
              <span class="shimmy2">ğŸ±</span>
              <span class="shimmy3">ğŸ’ƒ</span>
              <span class="shimmy4">ğŸ¶</span>
              <span class="shimmy1">ğŸ•º</span>
            </div>
          </div>

          <div class="mini" style="margin-top:10px;">Ù†ØµÙŠØ­Ø©: Ø¥Ø°Ø§ ØµØ§Ø± ØªÙˆØªØ± Ø¨Ø§Ù„Ù…Ø­Ù„â€¦ Ø§ÙØªØ­/ÙŠ Ù‡Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ù£ Ø«ÙˆØ§Ù†ÙŠ ÙˆØ§Ø±Ø¬Ø¹/ÙŠ Ù„Ù„Ø®Ø·ÙˆØ§Øª ğŸ˜„</div>
        </div>
      </section>

    </div>
  </div>

  <script>
    const OLD_PER_NEW = 100;

    function normalizeArabicDigits(str) {
      const map = { 'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9',
                    'Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9' };
      return String(str).replace(/[Ù -Ù©Û°-Û¹]/g, d => map[d] ?? d);
    }
    function parseNumber(s) {
      if (!s) return 0;
      const normalized = normalizeArabicDigits(s);
      const cleaned = normalized.replace(/[,\s\u066C\u066B]/g, '');
      const n = Number(cleaned);
      return Number.isFinite(n) ? n : NaN;
    }
    function fmtAr(n) { try { return new Intl.NumberFormat('ar').format(n); } catch { return String(n); } }
    function fmtArNew(n) {
      const rounded = Math.round(n * 100) / 100;
      const isInt = Math.abs(rounded - Math.round(rounded)) < 1e-9;
      return fmtAr(isInt ? Math.round(rounded) : rounded);
    }
    function toOld(oldVal, newVal) { return oldVal + (newVal * OLD_PER_NEW); }
    function oldToNew(oldAmount) { return oldAmount / OLD_PER_NEW; }

    async function copyText(text, statusEl) {
      try { await navigator.clipboard.writeText(text); statusEl.textContent='ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…'; setTimeout(()=>statusEl.textContent='',1500); }
      catch { statusEl.textContent='Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù†Ø³Ø® (Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹)'; setTimeout(()=>statusEl.textContent='',2500); }
    }

    function markSelected(ids, selectedId) {
      ids.forEach(id => { const b=document.getElementById(id); b.classList.remove('secondary'); b.classList.add('ghost'); });
      const s=document.getElementById(selectedId); s.classList.remove('ghost'); s.classList.add('secondary');
    }
    function show(el, yes=true) { el.classList.toggle('hidden', !yes); }

    document.getElementById('rulePill').textContent = `Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„: Ù¡ Ø¬Ø¯ÙŠØ¯Ø© = ${fmtAr(OLD_PER_NEW)} Ù‚Ø¯ÙŠÙ…Ø©`;

    // Tabs
    const tabConvert = document.getElementById('tabConvert');
    const tabWizard  = document.getElementById('tabWizard');
    const tabFun     = document.getElementById('tabFun');

    const sectionConvert = document.getElementById('sectionConvert');
    const sectionWizard  = document.getElementById('sectionWizard');
    const sectionFun     = document.getElementById('sectionFun');

    function setActiveTab(activeBtn) {
      [tabConvert, tabWizard, tabFun].forEach(b => b.classList.remove('active'));
      activeBtn.classList.add('active');
    }

    function showTab(which) {
      show(sectionConvert, which === 'convert');
      show(sectionWizard,  which === 'wizard');
      show(sectionFun,     which === 'fun');
      if(which === 'convert') setActiveTab(tabConvert);
      if(which === 'wizard')  setActiveTab(tabWizard);
      if(which === 'fun')     setActiveTab(tabFun);
    }

    tabConvert.addEventListener('click', () => showTab('convert'));
    tabWizard.addEventListener('click',  () => showTab('wizard'));
    tabFun.addEventListener('click',     () => showTab('fun'));

    // Convert tab
    const oldAmt = document.getElementById('oldAmt');
    const newAmt = document.getElementById('newAmt');
    const totalOldEl = document.getElementById('totalOld');
    const totalNewEl = document.getElementById('totalNew');
    const convertWarn = document.getElementById('convertWarn');

    function updateConvert() {
      convertWarn.textContent = '';
      const o = parseNumber(oldAmt.value);
      const n = parseNumber(newAmt.value);
      if (Number.isNaN(o) || Number.isNaN(n)) { convertWarn.textContent='Ø±Ø¬Ø§Ø¡Ù‹ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© ÙÙ‚Ø·.'; return; }
      const sumOld = toOld(o,n);
      totalOldEl.textContent = fmtAr(Math.round(sumOld));
      totalNewEl.textContent = fmtArNew(oldToNew(sumOld));
    }
    oldAmt.addEventListener('input', updateConvert);
    newAmt.addEventListener('input', updateConvert);

    document.getElementById('priceIsNewBtn').addEventListener('click', () => { oldAmt.value='0'; newAmt.focus(); updateConvert(); });
    document.getElementById('priceIsOldBtn').addEventListener('click', () => { newAmt.value='0'; oldAmt.focus(); updateConvert(); });

    document.getElementById('copyConvert').addEventListener('click', () => {
      const text = `Ø§Ù„Ù†ØªÙŠØ¬Ø©:\n- Ø¨Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${totalNewEl.textContent}\n- Ø¨Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©: ${totalOldEl.textContent}\nÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„: 1 Ø¬Ø¯ÙŠØ¯Ø© = ${OLD_PER_NEW} Ù‚Ø¯ÙŠÙ…Ø©`;
      copyText(text, document.getElementById('copyConvertStatus'));
    });

    // Wizard state
    const state = { priceOld:0, paidOld:0, expectedChangeOld:0, mode_s1:null, mode_s2:null, mode_s3:null, mode_v:null, lastOutcome:null, lastText:'' };

    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const needMoreBox = document.getElementById('needMoreBox');
    const verifyPromptBox = document.getElementById('verifyPromptBox');
    const finalSummary = document.getElementById('finalSummary');

    function resetWizard() {
      ['s1_old_in','s1_new_in','s2_old_in','s2_new_in','s3_old_in','s3_new_in','v_old_in','v_new_in'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });

      Object.assign(state, { priceOld:0, paidOld:0, expectedChangeOld:0, mode_s1:null, mode_s2:null, mode_s3:null, mode_v:null, lastOutcome:null, lastText:'' });

      show(step2,false); show(step3,false); show(needMoreBox,false); show(verifyPromptBox,false); show(finalSummary,false);
      show(document.getElementById('verify_inputs_area'), false);
      show(document.getElementById('v_out'), false);

      ['s1_warn','s2_warn','s3_warn','r_warn','v_warn'].forEach(id => document.getElementById(id).textContent='');

      ['s1_old_box','s1_new_box','s2_old_box','s2_new_box','s3_old_box','s3_new_box','v_old_box','v_new_box'].forEach(id => show(document.getElementById(id), false));
      step1.scrollIntoView({ behavior:'smooth', block:'start' });
    }
    document.getElementById('restart').addEventListener('click', resetWizard);

    function setMode(prefix, mode) {
      const oldBox=document.getElementById(`${prefix}_old_box`);
      const newBox=document.getElementById(`${prefix}_new_box`);
      if(mode==='old'){ show(oldBox,true); show(newBox,false); }
      else if(mode==='new'){ show(oldBox,false); show(newBox,true); }
      else if(mode==='both'){ show(oldBox,true); show(newBox,true); }
      else { show(oldBox,false); show(newBox,false); }
    }

    function readAmount(prefix, mode, warnId) {
      const warnEl=document.getElementById(warnId); warnEl.textContent='';
      if(!mode){ warnEl.textContent='Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙˆÙ„Ø§Ù‹.'; return null; }

      const oEl=document.getElementById(`${prefix}_old_in`);
      const nEl=document.getElementById(`${prefix}_new_in`);
      const o=oEl?parseNumber(oEl.value):0;
      const n=nEl?parseNumber(nEl.value):0;

      if(Number.isNaN(o)||Number.isNaN(n)){ warnEl.textContent='Ø±Ø¬Ø§Ø¡Ù‹ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø© ÙÙ‚Ø·.'; return null; }

      if(mode==='old'){ if(!oEl.value){ warnEl.textContent='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.'; return null; } return toOld(o,0); }
      if(mode==='new'){ if(!nEl.value){ warnEl.textContent='Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.'; return null; } return toOld(0,n); }
      if(!oEl.value && !nEl.value){ warnEl.textContent='Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºØ§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.'; return null; }
      return toOld(o,n);
    }

    // Step 1 mode buttons
    document.getElementById('s1_old').addEventListener('click', ()=>{ state.mode_s1='old'; markSelected(['s1_old','s1_new','s1_both'],'s1_old'); setMode('s1','old'); });
    document.getElementById('s1_new').addEventListener('click', ()=>{ state.mode_s1='new'; markSelected(['s1_old','s1_new','s1_both'],'s1_new'); setMode('s1','new'); });
    document.getElementById('s1_both').addEventListener('click', ()=>{ state.mode_s1='both'; markSelected(['s1_old','s1_new','s1_both'],'s1_both'); setMode('s1','both'); });

    // Step 2 mode buttons
    document.getElementById('s2_old').addEventListener('click', ()=>{ state.mode_s2='old'; markSelected(['s2_old','s2_new','s2_both'],'s2_old'); setMode('s2','old'); });
    document.getElementById('s2_new').addEventListener('click', ()=>{ state.mode_s2='new'; markSelected(['s2_old','s2_new','s2_both'],'s2_new'); setMode('s2','new'); });
    document.getElementById('s2_both').addEventListener('click', ()=>{ state.mode_s2='both'; markSelected(['s2_old','s2_new','s2_both'],'s2_both'); setMode('s2','both'); });

    // Step 3 additional pay mode buttons
    document.getElementById('s3_old').addEventListener('click', ()=>{ state.mode_s3='old'; markSelected(['s3_old','s3_new','s3_both'],'s3_old'); setMode('s3','old'); });
    document.getElementById('s3_new').addEventListener('click', ()=>{ state.mode_s3='new'; markSelected(['s3_old','s3_new','s3_both'],'s3_new'); setMode('s3','new'); });
    document.getElementById('s3_both').addEventListener('click', ()=>{ state.mode_s3='both'; markSelected(['s3_old','s3_new','s3_both'],'s3_both'); setMode('s3','both'); });

    // Verify prompt
    document.getElementById('verify_yes').addEventListener('click', ()=>{ show(document.getElementById('verify_inputs_area'), true); show(document.getElementById('v_out'), false); });
    document.getElementById('verify_no').addEventListener('click', ()=>{ show(document.getElementById('verify_inputs_area'), false); show(document.getElementById('v_out'), false); });

    // Verify mode buttons
    document.getElementById('v_old').addEventListener('click', ()=>{ state.mode_v='old'; markSelected(['v_old','v_new','v_both'],'v_old'); setMode('v','old'); });
    document.getElementById('v_new').addEventListener('click', ()=>{ state.mode_v='new'; markSelected(['v_old','v_new','v_both'],'v_new'); setMode('v','new'); });
    document.getElementById('v_both').addEventListener('click', ()=>{ state.mode_v='both'; markSelected(['v_old','v_new','v_both'],'v_both'); setMode('v','both'); });

    function renderPriceKnown() {
      document.getElementById('k_price_hint').textContent =
        `Ø§Ù„Ø¢Ù† ÙŠØ¬Ø¨ Ø¯ÙØ¹ ${fmtArNew(oldToNew(state.priceOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(state.priceOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.`;
    }

    function fillSummary(extraNote='') {
      const priceLine = `${fmtArNew(oldToNew(state.priceOld))} Ø¬Ø¯ÙŠØ¯Ø© | ${fmtAr(Math.round(state.priceOld))} Ù‚Ø¯ÙŠÙ…Ø©`;
      const paidLine  = `${fmtArNew(oldToNew(state.paidOld))} Ø¬Ø¯ÙŠØ¯Ø© | ${fmtAr(Math.round(state.paidOld))} Ù‚Ø¯ÙŠÙ…Ø©`;
      document.getElementById('sum_price').textContent = priceLine;
      document.getElementById('sum_paid').textContent = paidLine;
      document.getElementById('sum_result').textContent = (state.lastText || 'â€”') + (extraNote ? ` ${extraNote}` : '');
    }

    function renderResultAndNext() {
      const msg=document.getElementById('r_message'); msg.className='muted';
      document.getElementById('r_warn').textContent='';

      state.expectedChangeOld = state.paidOld - state.priceOld;

      show(needMoreBox,false);
      show(verifyPromptBox,false);

      if (Math.round(state.expectedChangeOld) === 0) {
        state.lastOutcome='exact';
        state.lastText='ØªÙ… Ø§Ù„Ø¯ÙØ¹ ØªÙ…Ø§Ù…Ø§Ù‹. Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ù‚ÙŠ âœ…';
        msg.textContent=state.lastText; msg.classList.add('ok');
        show(finalSummary,true); fillSummary();
        return;
      }

      if (state.expectedChangeOld > 0) {
        const chOld = state.expectedChangeOld;
        state.lastOutcome='needReturn';
        state.lastText=`Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø£Ù† ÙŠØ¹ÙŠØ¯ ${fmtArNew(oldToNew(chOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(chOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.`;
        msg.textContent=state.lastText; msg.classList.add('ok');
        show(verifyPromptBox,true);
        show(finalSummary,true); fillSummary();
        return;
      }

      const oweOld = Math.abs(state.expectedChangeOld);
      state.lastOutcome='needMore';
      state.lastText=`Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ¬Ø¨ Ø¯ÙØ¹ ${fmtArNew(oldToNew(oweOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(oweOld))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.`;
      msg.textContent=state.lastText; msg.classList.add('bad');
      show(needMoreBox,true);
      show(finalSummary,true); fillSummary();
    }

    // Step 1 -> next
    document.getElementById('s1_next').addEventListener('click', ()=>{
      const priceOld = readAmount('s1', state.mode_s1, 's1_warn');
      if(priceOld===null) return;
      state.priceOld = priceOld;
      renderPriceKnown();
      show(step2,true);
      step2.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // Step 2 back
    document.getElementById('s2_back').addEventListener('click', ()=>{
      show(step2,false); show(step3,false); show(finalSummary,false);
      step1.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // Step 2 -> next (result)
    document.getElementById('s2_next').addEventListener('click', ()=>{
      const paidOld = readAmount('s2', state.mode_s2, 's2_warn');
      if(paidOld===null) return;
      state.paidOld = paidOld;
      show(step3,true);
      renderResultAndNext();
      step3.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // Additional pay apply
    document.getElementById('s3_apply').addEventListener('click', ()=>{
      const addOld = readAmount('s3', state.mode_s3, 's3_warn');
      if(addOld===null) return;
      state.paidOld += addOld;
      renderResultAndNext();
      if(state.expectedChangeOld >= 0) {
        show(verifyPromptBox, true);
        verifyPromptBox.scrollIntoView({behavior:'smooth', block:'start'});
      }
    });

    // Verify check
    document.getElementById('v_check').addEventListener('click', ()=>{
      const warnEl=document.getElementById('v_warn'); warnEl.textContent='';
      if(state.expectedChangeOld < 0) { warnEl.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ù‚ÙŠ Ù…ØªÙˆÙ‚Ø¹ Ø­Ø§Ù„ÙŠØ§Ù‹ (Ù„Ø§ ÙŠØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø¯ÙØ¹Ù‡).'; return; }

      const expectedOld = state.expectedChangeOld;
      const receivedOld = readAmount('v', state.mode_v, 'v_warn');
      if(receivedOld===null) return;

      show(document.getElementById('v_out'), true);
      document.getElementById('v_expected_old').textContent = fmtAr(Math.round(expectedOld));
      document.getElementById('v_expected_new').textContent = fmtArNew(oldToNew(expectedOld));
      document.getElementById('v_received_old').textContent = fmtAr(Math.round(receivedOld));
      document.getElementById('v_received_new').textContent = fmtArNew(oldToNew(receivedOld));

      const diff = receivedOld - expectedOld;
      const msg=document.getElementById('v_msg');

      if(Math.round(diff)===0) {
        msg.textContent='Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØµØ­ÙŠØ­ âœ…'; msg.className='muted ok';
        fillSummary('â€” ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚: Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØµØ­ÙŠØ­ âœ…');
      } else if(diff < 0) {
        const owe=Math.abs(diff);
        msg.textContent=`Ø£Ø¹Ø§Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø£Ù‚Ù„ Ù…Ù…Ø§ ÙŠØ¬Ø¨. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹ÙŠØ¯ Ø£ÙŠØ¶Ø§Ù‹ ${fmtArNew(oldToNew(owe))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(owe))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©. â—`;
        msg.className='muted bad';
        fillSummary(`â€” ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚: Ø£Ø¹Ø§Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø£Ù‚Ù„ Ù…Ù…Ø§ ÙŠØ¬Ø¨ (${fmtArNew(oldToNew(owe))} Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(owe))} Ù‚Ø¯ÙŠÙ…Ø©) â—`);
      } else {
        const extra = diff; // diff > 0
        msg.textContent =
          `Ø£Ø¹Ø§Ø¯ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${fmtArNew(oldToNew(extra))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(extra))} Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©. âœ…`;
        msg.className = 'muted ok';
        fillSummary(`â€” ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚: Ø£Ø¹Ø§Ø¯ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (${fmtArNew(oldToNew(extra))} Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(extra))} Ù‚Ø¯ÙŠÙ…Ø©) âœ…`);
      }
    });

    // Copy result & summary
    document.getElementById('copyResult').addEventListener('click', ()=>{
      const priceOld=state.priceOld, paidOld=state.paidOld;
      const ch=paidOld-priceOld;
      let line='';
      if(Math.round(ch)===0) line='ØªÙ… Ø§Ù„Ø¯ÙØ¹ ØªÙ…Ø§Ù…Ø§Ù‹. Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ù‚ÙŠ.';
      else if(ch>0) line=`Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ø£Ù† ÙŠØ¹ÙŠØ¯ ${fmtArNew(oldToNew(ch))} Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(ch))} Ù‚Ø¯ÙŠÙ…Ø©.`;
      else { const owe=Math.abs(ch); line=`Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ¬Ø¨ Ø¯ÙØ¹ ${fmtArNew(oldToNew(owe))} Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ ${fmtAr(Math.round(owe))} Ù‚Ø¯ÙŠÙ…Ø©.`; }

      const text = `Ù…Ù„Ø®Øµ:\n- Ø§Ù„Ø³Ø¹Ø±: ${fmtArNew(oldToNew(priceOld))} Ø¬Ø¯ÙŠØ¯Ø© | ${fmtAr(Math.round(priceOld))} Ù‚Ø¯ÙŠÙ…Ø©\n- Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${fmtArNew(oldToNew(paidOld))} Ø¬Ø¯ÙŠØ¯Ø© | ${fmtAr(Math.round(paidOld))} Ù‚Ø¯ÙŠÙ…Ø©\n${line}\nÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„: 1 Ø¬Ø¯ÙŠØ¯Ø© = ${OLD_PER_NEW} Ù‚Ø¯ÙŠÙ…Ø©`;
      copyText(text, document.getElementById('copyResultStatus'));
    });

    document.getElementById('copySummary').addEventListener('click', ()=>{
      const text = `Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:\n- Ø§Ù„Ø³Ø¹Ø±: ${document.getElementById('sum_price').textContent}\n- Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${document.getElementById('sum_paid').textContent}\n- Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${document.getElementById('sum_result').textContent}\nÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„: 1 Ø¬Ø¯ÙŠØ¯Ø© = ${OLD_PER_NEW} Ù‚Ø¯ÙŠÙ…Ø©`;
      copyText(text, document.getElementById('copySummaryStatus'));
    });

    // ===== Fun tab logic =====
    const funStage = document.getElementById('funStage');
    function renderFun(kind) {
      const cats = ['ğŸ±','ğŸˆ','ğŸ˜º','ğŸ¾'];
      const dogs = ['ğŸ¶','ğŸ•','ğŸ¦®','ğŸ¾'];
      const dancers = ['ğŸ’ƒ','ğŸ•º','ğŸ’ƒ','ğŸ•º'];
      let items = [];

      if(kind === 'cats') items = [cats[0], dancers[0], cats[1], dancers[1], cats[2], dancers[2], cats[3], dancers[3]];
      else if(kind === 'dogs') items = [dogs[0], dancers[0], dogs[1], dancers[1], dogs[2], dancers[2], dogs[3], dancers[3]];
      else items = ['ğŸ±','ğŸ’ƒ','ğŸ¶','ğŸ•º','ğŸ±','ğŸ’ƒ','ğŸ¶','ğŸ•º'];

      funStage.innerHTML = items.map((x, i) => {
        const cls = ['shimmy1','shimmy2','shimmy3','shimmy4'][i % 4];
        return `<span class="${cls}">${x}</span>`;
      }).join('');
    }

    document.getElementById('funCats').addEventListener('click', ()=>{ renderFun('cats'); markSelected(['funCats','funDogs','funBoth'],'funCats'); });
    document.getElementById('funDogs').addEventListener('click', ()=>{ renderFun('dogs'); markSelected(['funCats','funDogs','funBoth'],'funDogs'); });
    document.getElementById('funBoth').addEventListener('click', ()=>{ renderFun('both'); markSelected(['funCats','funDogs','funBoth'],'funBoth'); });

    // Init
    resetWizard();
    updateConvert();
    renderFun('both');
  </script>
</body>
</html>